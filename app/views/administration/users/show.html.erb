<% content_for :right_pane do %>
  <div class="page-header">
    <h2>Détails client</h2>
  </div>
  <address>
    <%= address_tag @user %>
  </address>
  <p>
    <%= details_tag @user %>
    <small>[<%= link_to "Modifier", edit_administration_user_path(@user) %>]</small>
  </p>
<% end %>

<% title = raw("Contrats<small> appartenant à #{@user.name_tag}</small>") +
  link_to(raw('<i class="icon-plus-sign icon-white"></i> Nouveau contrat'),
          new_administration_user_contract_path(@user),
          :class => 'btn btn-primary pull-right',
          :title => "Créer un nouveau contrat",
          :rel => "tooltip") %>

<%= render :partial => "breadcrumbs", :locals => { :title => title } %>

<% unless @user.contracts.empty? %>
  <% @user.contracts.each_with_index do |contract, index| %>
    <div class="alert alert-info">
      <h3 class="alert-heading">
        <%= "#{index+1}. #{contract.name.capitalize}" %>
        <div class="btn-group pull-right">
                <%= link_to raw('<i class="icon-eye-open"></i>'),
                  administration_user_contract_path(@user, contract),
                  :title => "Voir les détails du contrat (fichiers)", :rel => "tooltip",
                  :class => "btn btn-small" %>
                <%= link_to raw('<i class="icon-edit"></i>'),
                  edit_administration_user_contract_path(@user, contract),
                  :title => "Modifier le contrat", :rel => "tooltip",
                  :class => "btn btn-small" %>
                <%= link_to raw('<i class="icon-trash icon-white"></i>'),
                  administration_user_contract_path(@user, contract),
                  :title => "Supprimer le contrat", :rel => "tooltip",
                  :method => :delete, :class => "btn btn-small btn-danger",
                  :confirm => "Êtes vous sur de vouloir supprimer le contrat #{contract.name} ?" %>
                <%= link_to raw('<i class="icon-plus-sign icon-white"></i>'),
                  new_administration_user_contract_document_path(@user,contract),
                  :title => "Ajouter un fichier", :rel => "tooltip",
                  :class => "btn btn-small btn-inverse" %>
        </div>
      </h3>
    </div>
    <% if contract.documents.empty? %>
      Aucun fichier : <%= link_to 'Ajouter un fichier', new_administration_user_contract_document_path(@user, contract) %>
  <% else %>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Fichier</th>
          <th>Taille</th>
          <th>Versions</th>
          <th class="pull-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% contract.documents.each do |document| %>
          <tr>
            <td>
              <%= image_tag(get_image_from_ext(document.file_name)) %>
              <%= link_to document.file_name.capitalize, administration_user_contract_document_path(@user, contract, document), :class => "valign-top" %>
            </td>
            <td><%= number_to_human_size document.uploaded_file_file_size %></td>
            <td><%= document.versions.empty? ? 1 : document.versions.size %></td>
            <td>
              <div class="btn-group pull-right">
                <%= link_to raw('<i class="icon-download icon-white"></i>'), admin_download_url(document),
                  :class => "btn btn-info btn-mini",
                  :title => "Télécharger le fichier", :rel => "tooltip" %>
                <%= link_to raw('<i class="icon-eye-open"></i>'),
                  administration_user_contract_document_path(@user,contract,document),
                  :class => "btn btn-mini",
                  :title => "Voir le fichier", :rel => "tooltip" %>
                <%= link_to raw('<i class="icon-edit"></i>'),
                  edit_administration_user_contract_document_path(@user, contract, document),
                  :class => "btn btn-mini",
                  :title => "Modifier le fichier", :rel => "tooltip" %>
                <%= link_to raw('<i class="icon-trash icon-white"></i>'),
                  administration_user_contract_document_path(@user, contract, document),
                  :method => :delete, :class => "btn btn-danger btn-mini",
                  :title => "Supprimer le fichier", :rel => "tooltip",
                  :confirm => "Êtes vous sûr de vouloir supprimer le fichier #{document.file_name.capitalize}" %>
              </div>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>
  <hr/>
<% end %>
<% else %>
  <p>
    <i class="icon-info-sign"></i>
    Aucun contrat : <%= link_to 'Ajouter un contrat', new_administration_user_contract_path(@user) %>
  </p>
<% end %>
