<% content_for :breadcrumbs do %>
<ul class="breadcrumb">
  <li>
    <%= link_to "Administration", administration_users_path %>
    <span class="divider">/</span>
  </li>
  <li>
    <%= link_to "Utilisateur : #{@user.name_tag}", administration_user_path(@user) %>
    <span class="divider">/</span>
  </li>
  <li>
    <%= link_to "Contrat : #{@contract.name.capitalize}", administration_user_contract_path(@user, @contract) %>
    <span class="divider">/</span>
  </li>
  <li class="active">
    <%= link_to "Fichier : #{@document.file_name.capitalize}",  administration_user_contract_documents_path(@user, @contract, @document) %>
  </li>
</ul>
<% end %>

<div class="page-header">
  <h2>
    Historique des différentes versions du fichier "<%= @document.file_name.capitalize %>"
  </h2>
</div>
<% if @document.versions.empty? %>
  <%= @document.file_name  %>
<% else %>
  <table class="table table-striped table-bordered table-condensed">
    <thead>
      <tr>
        <th>Version #</th>
        <th>Modifié le</th>
        <th>Modifié Par</th>
        <th>Taille</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @document.versions.size+1 %>.</td>
        <td>
          <span rel="tooltip" title="Crée <%= I18n.localize(@document.uploaded_file_updated_at, :format => "le %d %B %Y à %H:%M:%S") %>">
            Il y a <%= distance_of_time_in_words_to_now @document.uploaded_file_updated_at %>
          </span>
        </td>
        <td><%= User.find_by_id(@document.create_by).name_tag %></td>
        <td><%= number_to_human_size @document.uploaded_file_file_size %></td>
        <td>
          <div class="btn-group pull-right">
            <%= link_to raw('<i class="icon-download"></i>'), admin_download_url(@document, :vid => @document.versions.last.number),
              :class => "btn btn-mini",
              :title => "Télécharger le fichier", :rel => "tooltip" %>
            <%= link_to raw('<i class="icon-trash icon-white"></i>'),
              administration_user_contract_document_path(@user, @contract, @document),
              :method => :delete, :class => "btn btn-danger btn-mini",
              :title => "Supprimer le fichier", :rel => "tooltip",
              :confirm => "Êtes vous sûr de vouloir supprimer le fichier #{@document.file_name.capitalize}" %>
          </div>
        </td>
      </tr>
      <% @document.versions.limit(10).order("created_at DESC").each_with_index do |version, index| %>
      <%#= binding.pry %>
        <tr>
          <td><%= "#{@document.versions.size-index}." %></td>
          <td>
          <span rel="tooltip" title="Crée <%= I18n.localize(version.modifications["uploaded_file_updated_at"][0], :format => "le %d %B %Y à %H:%M:%S") %>">
              Il y a <%= distance_of_time_in_words_to_now version.modifications["uploaded_file_updated_at"][0] %>
            </span>
          </td>
          <td><%= User.find_by_id(version.user_id).name_tag %></td>
          <td><%= number_to_human_size version.modifications["uploaded_file_file_size"][0] %></td>
          <td>
            <div class="btn-group pull-right">
              <%= link_to raw('<i class="icon-download"></i>'), admin_download_url(@document, :vid => (version.number-1)),
                :class => "btn btn-mini",
                :title => "Télécharger le fichier", :rel => "tooltip" %>
              <%= link_to raw('<i class="icon-trash icon-white"></i>'),
                administration_user_contract_document_path(@user, @contract, @document),
                :method => :delete, :class => "btn btn-danger btn-mini",
                :title => "Supprimer le fichier", :rel => "tooltip",
                :confirm => "Êtes vous sûr de vouloir supprimer le fichier #{@document.file_name.capitalize}" %>
            </div>
          </td>
        </tr>
      <% end -%>
    </tbody>
  </table>
<% end %>
<div class="form-actions">
    <%= link_to raw('<i class="icon-ban-circle"></i> Retour'), administration_user_contract_path(@user, @contract), :class => 'btn'  %>
              <%= link_to raw('<i class="icon-edit"></i> Mettre à jour le document'),
                edit_administration_user_contract_document_path(@user, @contract, @document),
                :class => "btn",
                :title => "Uploader une nouvelle version du fichier", :rel => "tooltip" %>

    <%= link_to raw('<i class="icon-trash icon-white"></i> Supprimer le Fichier'),
      administration_user_contract_document_path(@user, @contract, @document),
      :method => 'delete', :confirm => 'Etes vous sur ?', :class => 'btn btn-danger pull-right' %>
</div>
